name: Packaging

on:
   - push

jobs:
   format:
      name: Check code formatting
      runs-on: ubuntu-latest
      steps:
         - uses: actions/checkout@v3
         - uses: actions/setup-python@v4.0.0
           with:
              python-version: "3.10"
         - name: Install tox
           run: python -m pip install tox
         - name: Run black
           run: tox -e format
   lint:
      name: Check code linting
      runs-on: ubuntu-latest
      steps:
         - uses: actions/checkout@v3
         - uses: actions/setup-python@v4.0.0
           with:
              python-version: "3.10"
         - name: Install tox
           run: python -m pip install tox
         - name: Run flake8
           run: tox -e lint
   typecheck:
      name: Static type checking
      runs-on: ubuntu-latest
      steps:
         - uses: actions/checkout@v3
         - uses: actions/setup-python@v4.0.0
           with:
              python-version: "3.10"
         - name: Install tox
           run: python -m pip install tox
         - name: Run mypy
           run: tox -e typecheck
   test:
      name: Test
      runs-on: ubuntu-latest
      strategy:
         matrix:
            python:
               - version: "3.7"
                 toxenv: "py37"
               - version: "3.8"
                 toxenv: "py38"
               - version: "3.9"
                 toxenv: "py39"
               - version: "3.10"
                 toxenv: "py310"
      steps:
         - uses: actions/checkout@v3
         - uses: actions/setup-python@v4.0.0
           with:
              python-version: ${{ matrix.python.version }}
         - name: Install tox
           run: python -m pip install tox
         - name: Run pytest
           run: tox -e ${{ matrix.python.toxenv }}
   build_wheels:
      name: Build wheels on ${{ matrix.os }}
      runs-on: ${{ matrix.os }}
      strategy:
         matrix:
            os:
               - ubuntu-20.04
               - windows-2019
               - macOS-10.15
      steps:
         - uses: actions/checkout@v3
         - uses: actions/setup-python@v4.0.0
           with:
              python-version: "3.10"
         - name: Install cibuildwheel
           run: python -m pip install cibuildwheel
         - name: Build wheels
           run: pyuthon -m cibuildwheel --output-dir wheels
         - uses: actions/upload-artifact@v3
           with:
              path: ./wheels/*.whl
           
